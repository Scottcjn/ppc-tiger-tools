--- Python 3.8.18 Mac OS X Tiger (10.4) Compatibility Patch ---
--- This patch disables copyfile.h usage on Tiger (Darwin < 9)
--- copyfile.h was introduced in Leopard (10.5, Darwin 9)

diff -u a/Modules/posixmodule.c b/Modules/posixmodule.c
--- a/Modules/posixmodule.c
+++ b/Modules/posixmodule.c
@@ -111,8 +111,14 @@
 #endif
 
-#if defined(__APPLE__)
+#if defined(__APPLE__) && __ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__ >= 1050
 #include <copyfile.h>
+#define HAVE_FCOPYFILE 1
+#else
+#if defined(__APPLE__)
+/* copyfile.h not available on macOS < 10.5 */
+#define HAVE_FCOPYFILE 0
+#endif
 #endif
 
 #ifdef HAVE_SCHED_H
@@ -9388,7 +9394,7 @@
 #endif /* HAVE_SENDFILE */
 
 
-#if defined(__APPLE__)
+#if defined(__APPLE__) && HAVE_FCOPYFILE
 /*[clinic input]
 os._fcopyfile
 
@@ -14493,7 +14499,7 @@
 #endif
 #endif
 
-#if defined(__APPLE__)
+#if defined(__APPLE__) && HAVE_FCOPYFILE
     if (PyModule_AddIntConstant(m, "_COPYFILE_DATA", COPYFILE_DATA)) return -1;
 #endif
 
diff -u a/Modules/clinic/posixmodule.c.h b/Modules/clinic/posixmodule.c.h
--- a/Modules/clinic/posixmodule.c.h
+++ b/Modules/clinic/posixmodule.c.h
@@ -5015,7 +5015,7 @@
 
 #endif /* defined(HAVE_SENDFILE) && !defined(__APPLE__) && (defined(__FreeBSD__) || defined(__DragonFly__)) */
 
-#if defined(__APPLE__)
+#if defined(__APPLE__) && HAVE_FCOPYFILE
 
 PyDoc_STRVAR(os__fcopyfile__doc__,
 "_fcopyfile($module, infd, outfd, flags, /)\n"
@@ -5073,6 +5073,9 @@
     return return_value;
 }
 
+#else
+#define OS__FCOPYFILE_METHODDEF
+
 #endif /* defined(__APPLE__) */
 
 PyDoc_STRVAR(os_fstat__doc__,
